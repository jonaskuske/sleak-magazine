{"version":3,"sources":["serviceworker.js"],"names":["PACKAGE_NAME","PACKAGE_VERSION","CACHE_NAME","ALLOWED_CACHES","STATIC_ASSETS","FALLBACK_IMAGE","self","addEventListener","event","waitUntil","caches","open","then","cache","fetch","response","json","assets","hashedAssets","Object","entries","filter","sourceURL","indexOf","endsWith","map","hashedURL","replace","addAll","skipWaiting","keys","cacheNames","cacheDeletePromises","cacheName","includes","delete","Promise","all","checkResponseStatus","r","res","rej","status","statusText","isRequestCacheable","request","url","URL","protocol","isResponseCacheable","type","requestFailingWith404","catch","body","JSON","stringify","error","Response","headers","requestThenCache","put","clone","match","href","Request","substring","respondWith","navigator","onLine"],"mappings":"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","file":"serviceworker.map","sourceRoot":"..","sourcesContent":["// Use name & version fields from package.json to manage caches\r\nconst PACKAGE_NAME = process.env.npm_package_name;\r\nconst PACKAGE_VERSION = process.env.npm_package_version;\r\nconst CACHE_NAME = `${PACKAGE_NAME}@${PACKAGE_VERSION}`;\r\n\r\nconst ALLOWED_CACHES = [\r\n  CACHE_NAME,\r\n  // ! If you want to whitelist any caches, add them here\r\n  // ! Any caches with a name not found in this array will be deleted\r\n  // ! from the client's browser once the service worker is activated\r\n];\r\n\r\nconst STATIC_ASSETS = [\r\n  '.',\r\n  './team', // TODO: remove in favor of sw rerouting\r\n  './print', // TODO: remove in favor of sw rerouting\r\n  './rechtliches', // TODO: remove in favor of sw rerouting\r\n  './articles/projekt-antarktis.html',\r\n  './articles/film-ab-bheaven.html',\r\n  './articles/axel-bertram.html',\r\n  './articles/bringt-farbe-in-die-stadt.html',\r\n  './articles/wie-ki-die-designwelt-aendert.html',\r\n  './articles/design-kunst.html',\r\n  './articles/digitale-medien.html',\r\n  './articles/moin-melanka.html',\r\n  './articles/back-to-print.html',\r\n  './articles/oesterreichs-newcomer-mihael-kobas.html',\r\n  './articles/zwischen-seemannsgarn-und-strandgut.html',\r\n];\r\n\r\nconst FALLBACK_IMAGE = `<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"><defs><style>.text{font-family:Lato,sans-serif;text-align:center}@media screen and (max-width:370px){.text{font-size:12px}}</style></defs><rect width=\"100%\" height=\"100%\" fill=\"#fff\"/><image width=\"80\" height=\"120\" x=\"50%\" y=\"50%\" transform=\"translate(-40 -60)\" xlink:href=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjBweCIgeT0iMHB4IiBmaWxsPSIjRDNEM0QzIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCI+DQogICAgPHBhdGggZD0iTTg4LjE3LDY5LjMyQTIyLDIyLDAsMCwwLDc3Ljc5LDM3Ljc3YTIyLDIyLDAsMCwwLTIxLjkxLTIwLjIsMjAuMjksMjAuMjksMCwwLDAtMTMuNjcsNC44MWw0LjU3LDUuM2ExMy4zMSwxMy4zMSwwLDAsMSw5LjEtMy4xMSwxNSwxNSwwLDAsMSwxNSwxNWMwLC4wNiwwLC4xMywwLC4xOXMwLC4yNiwwLC4zOWwtLjEsMi43NSwyLjY1Ljc1YTE1LDE1LDAsMCwxLDguNzksMjIuMVoiLz4NCiAgICA8cGF0aCBkPSJNMjguNzYsODBINjAuNDRWNzNIMjguNzZhMTUsMTUsMCwwLDEtMTUtMTVBMTcsMTcsMCwwLDEsMjMuNiw0Mi43bC0yLjc5LTYuNDJBMjMuOTEsMjMuOTEsMCwwLDAsNi43OCw1OCwyMiwyMiwwLDAsMCwyOC43Niw4MFoiLz4NCiAgICA8cmVjdCB3aWR0aD0iNyIgaGVpZ2h0PSIxMDYuNzUiIHg9IjQ1LjUzIiB5PSItNC41OCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIwLjE0IDQ4Ljk2KSByb3RhdGUoLTQ1KSIvPg0KPC9zdmc+DQo=\"/><text x=\"50%\" y=\"50%\" fill=\"#d3d3d3\" class=\"text\" text-anchor=\"middle\" transform=\"translate(0 60)\">Bild noch nicht f√ºr Offline-Nutzung gespeichert</text></svg>`;\r\n\r\n// get the filenames to cache from the parcel-manifest and add them to cache\r\nself.addEventListener('install', event => {\r\n  event.waitUntil(\r\n    caches\r\n      .open(CACHE_NAME)\r\n      .then(cache =>\r\n        fetch('./parcel-manifest.json')\r\n          .then(response => response.json())\r\n          .then(assets => {\r\n            const hashedAssets = Object.entries(assets)\r\n              // filter out files that are unnecessary to cache\r\n              .filter(\r\n                ([sourceURL]) =>\r\n                  sourceURL.indexOf('icon') < 0 &&\r\n                  !sourceURL.endsWith('.map') &&\r\n                  !sourceURL.endsWith('.webmanifest'),\r\n              )\r\n              .map(([_, hashedURL]) => {\r\n                // fix parcel bug where protocol misses a slash (https:/)\r\n                return hashedURL.replace(/https:\\/\\/?/, 'https://');\r\n              });\r\n\r\n            return cache.addAll([...STATIC_ASSETS, ...hashedAssets]);\r\n          }),\r\n      )\r\n      .then(() => self.skipWaiting()),\r\n  );\r\n});\r\n\r\n/* delete old caches on activation */\r\nself.addEventListener('activate', event => {\r\n  event.waitUntil(\r\n    caches.keys().then(cacheNames => {\r\n      const cacheDeletePromises = cacheNames.map(cacheName => {\r\n        if (!ALLOWED_CACHES.includes(cacheName)) {\r\n          return caches.delete(cacheName);\r\n        }\r\n      });\r\n      return Promise.all(cacheDeletePromises);\r\n    }),\r\n  );\r\n});\r\n\r\nconst checkResponseStatus = r =>\r\n  new Promise((res, rej) => {\r\n    if ((r.status >= 200 && r.status < 300) || r.status === 0) res(r);\r\n    else rej(r.statusText);\r\n  });\r\n/* Helper functions to determine whether requests/responses should be cached */\r\nconst isRequestCacheable = request => {\r\n  const url = new URL(request.url);\r\n  if (url.protocol === 'chrome-extension:') return false;\r\n\r\n  return true;\r\n};\r\nconst isResponseCacheable = response => {\r\n  // don't cache opaque response to prevent exceeding cache size quota\r\n  // see https://cloudfour.com/thinks/when-7-kb-equals-7-mb/\r\n  if (response.status === 0 || response.type === 'opaque') return false;\r\n\r\n  return true;\r\n};\r\n// const shouldAppendHTML = pathname => {\r\n//   return /(\\/rechtliches|\\/team|\\/print)$/.test(pathname);\r\n// };\r\n\r\nconst requestFailingWith404 = event => {\r\n  return fetch(event.request).catch(() => {\r\n    const body = JSON.stringify({\r\n      error:\r\n        \"Sorry, you're offline. Try again once you have a working internet connection.\",\r\n    });\r\n    const headers = { 'Content-Type': 'application/json' };\r\n    return new Response(body, {\r\n      status: 404,\r\n      statusText: 'Not Found',\r\n      headers,\r\n    });\r\n  });\r\n};\r\nconst requestThenCache = (event, cache) => {\r\n  return fetch(event.request)\r\n    .then(checkResponseStatus)\r\n    .then(response => {\r\n      if (isResponseCacheable(response)) {\r\n        cache.put(event.request, response.clone());\r\n      }\r\n      return response;\r\n    })\r\n    .catch(() => {\r\n      if (event.request.url.match(/\\.(jpe?g|png|gif|svg)$/)) {\r\n        return new Response(FALLBACK_IMAGE, {\r\n          headers: {\r\n            'Content-Type': 'image/svg+xml',\r\n            'Cache-Control': 'no-store',\r\n          },\r\n        });\r\n      } else return requestFailingWith404(event);\r\n    });\r\n};\r\n\r\nself.addEventListener('fetch', event => {\r\n  // if request should not be cached: respond with normal 404 fetch and return\r\n  if (!isRequestCacheable(event.request)) {\r\n    event.respondWith(requestFailingWith404(event));\r\n    return;\r\n  }\r\n\r\n  let request = event.request;\r\n  let url = new URL(request.url);\r\n  /*console.log('%cüåê Pathname: ' + url.pathname, 'color:darkblue', 'color:#000');\r\n    console.log(url.pathname);\r\n    // ! Re-route /print to /print.html etc.\r\n    if (shouldAppendHTML(url.pathname)) {\r\n      // Update pathname with HTML file extension\r\n      url.pathname += '.html';\r\n      // Use new request based on updated URL from now on\r\n      request = new Request(url);\r\n\r\n      console.log(\r\n        '%c‚ö† Redirect mode: %c' + request.redirect,\r\n        'color: darkslategray;',\r\n        'color: #000;',\r\n      );\r\n      console.log('%c‚è≥ Updating Request...', 'font-weight:bold;color:red;');\r\n      console.log(request);\r\n    }*/\r\n\r\n  // ! Ignore query strings\r\n  if (url.href.includes('?')) {\r\n    request = new Request(url.href.substring(url.href.indexOf('?') + 1));\r\n  }\r\n\r\n  event.respondWith(\r\n    caches\r\n      .match(request)\r\n      .then(checkResponseStatus)\r\n      .then(response => {\r\n        // console.log('%cüéâ Response found in cache!', 'color: gold;');\r\n        // console.log(response);\r\n        return caches.open(CACHE_NAME).then(cache => {\r\n          if (navigator.onLine) requestThenCache(event, cache);\r\n          return response;\r\n        });\r\n      })\r\n      .catch(() =>\r\n        caches.open(CACHE_NAME).then(cache => requestThenCache(event, cache)),\r\n      ),\r\n  );\r\n});\r\n"]}